<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>공지 생성기 + PUSH 생성기</title>
  <style>
    :root{
      --bg:#0b0f19; --card:#121a2a; --muted:#94a3b8; --text:#e5e7eb;
      --accent:#60a5fa; --accent2:#34d399; --danger:#fb7185; --border:#23324d;
      --input:#0f172a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:24px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
      background: radial-gradient(1000px 600px at 10% 0%, rgba(96,165,250,.18), transparent 60%),
                  radial-gradient(1000px 600px at 90% 10%, rgba(52,211,153,.14), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    header{
      max-width:1100px; margin:0 auto 18px auto;
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
    }
    h1{margin:0; font-size:22px; letter-spacing:-.2px}
    .sub{margin:0; color:var(--muted); font-size:13px}
    .wrap{max-width:1100px; margin:0 auto; display:grid; grid-template-columns:1fr; gap:16px}
    @media (min-width: 980px){
      .wrap{grid-template-columns: 1fr 1fr}
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .card h2{
      margin:0 0 10px 0; font-size:16px; letter-spacing:-.2px;
      display:flex; align-items:center; gap:8px;
    }
    .pill{
      font-size:12px; padding:4px 8px; border-radius:999px;
      border:1px solid var(--border); color:var(--muted);
      background:rgba(15,23,42,.4);
    }
    .grid{display:grid; grid-template-columns:1fr; gap:10px}
    @media (min-width: 560px){
      .grid.two{grid-template-columns:1fr 1fr}
    }
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px 2px}
    input, textarea, select{
      width:100%;
      background:rgba(15,23,42,.8);
      border:1px solid var(--border);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      transition:.15s border-color, .15s box-shadow;
      font-size:13px;
    }
    textarea{min-height:92px; resize:vertical; line-height:1.45}
    input:focus, textarea:focus, select:focus{
      border-color:rgba(96,165,250,.6);
      box-shadow:0 0 0 4px rgba(96,165,250,.12);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-top:10px}
    .btns{display:flex; gap:8px; flex-wrap:wrap}
    button{
      border:1px solid var(--border);
      background:rgba(15,23,42,.7);
      color:var(--text);
      padding:9px 11px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
      transition:.15s transform, .15s background, .15s border-color;
      user-select:none;
    }
    button:hover{transform: translateY(-1px); border-color: rgba(96,165,250,.55)}
    button.primary{background:rgba(96,165,250,.18); border-color: rgba(96,165,250,.35)}
    button.good{background:rgba(52,211,153,.14); border-color: rgba(52,211,153,.35)}
    button.danger{background:rgba(251,113,133,.12); border-color: rgba(251,113,133,.32)}
    .hint{font-size:12px; color:var(--muted); margin-top:6px}
    .out{
      margin-top:12px;
      border:1px solid var(--border);
      background:rgba(2,6,23,.35);
      border-radius:14px;
      padding:12px;
    }
    .out-head{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px}
    .out-title{font-size:12px; color:var(--muted)}
    pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-size:13px;
      line-height:1.5;
    }
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(15,23,42,.92);
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:999px;
      color:var(--text);
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition:.2s opacity, .2s transform;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-6px)}
    .small-actions{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .chk{
      display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px;
      user-select:none;
    }
    .chk input{width:auto; margin:0}
    footer{
      max-width:1100px; margin:14px auto 0 auto; color:var(--muted); font-size:12px;
    }
    code.k{color:#a7f3d0}
  </style>
</head>

<body>
  <header>
    <div>
      <h1>공지 생성기 + PUSH 생성기</h1>
      <p class="sub">단일 <code class="k">index.html</code> · <code class="k">[object Object]</code> 완전 제거 · Issue 공지 문장 퀄리티(현상→사과→조치→추가 안내)</p>
    </div>
    <div class="pill">GitHub Pages</div>
  </header>

  <main class="wrap">
    <!-- Issue Notice -->
    <section class="card" id="issueCard">
      <h2>Issue 공지 생성기 <span class="pill">현상 → 사과 → 조치 → 추가 안내</span></h2>

      <div class="grid two">
        <div>
          <label for="issueTitle">공지 제목(선택)</label>
          <input id="issueTitle" placeholder="예) [안내] 일부 이용자 접속 지연 관련" />
          <div class="hint">비우면 본문만 생성됩니다.</div>
        </div>
        <div>
          <label for="issueType">상황 유형</label>
          <select id="issueType">
            <option value="incident">장애/이슈 공지</option>
            <option value="maintenance">임시 점검 공지</option>
          </select>
          <div class="hint">임시 점검은 “현상 때문에 점검 진행 예정” 인과를 유지합니다.</div>
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="issueWhen">발생/인지 시각(선택)</label>
          <input id="issueWhen" placeholder="예) 1/14(수) 10:20" />
        </div>
        <div>
          <label for="issueScope">영향 범위(선택)</label>
          <input id="issueScope" placeholder="예) 일부 이용자 / iOS / 특정 지역 / 결제" />
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="issueSymptom">현상(필수)</label>
          <textarea id="issueSymptom" placeholder="예) 게임 접속이 지연되거나 간헐적으로 접속이 종료되는 현상이 발생하고 있습니다."></textarea>
        </div>
        <div>
          <label for="issueApology">사과 문장(선택, 미입력 시 자동)</label>
          <textarea id="issueApology" placeholder="예) 이용에 불편을 드려 대단히 죄송합니다."></textarea>
        </div>
        <div>
          <label for="issueAction">조치/진행 상황(필수)</label>
          <textarea id="issueAction" placeholder="예) 원인 파악 및 안정화 조치를 진행 중이며, 현재 서버 부하 완화 작업을 수행하고 있습니다."></textarea>
        </div>
        <div>
          <label for="issueExtra">추가 안내(필수)</label>
          <textarea id="issueExtra" placeholder="예) 정상화 시 본 공지를 통해 추가 안내드리겠습니다."></textarea>
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="issuePayload">참고 데이터/로그 payload (선택, 객체여도 안전)</label>
          <textarea id="issuePayload" placeholder='예) {"region":"KR","error":{"code":503,"message":"timeout"}} 또는 그냥 텍스트도 가능'></textarea>
          <div class="hint">여기 값이 객체/JSON/배열/텍스트여도 <b>[object Object]</b>가 절대 나오지 않게 안전하게 문자열화합니다.</div>
        </div>
      </div>

      <div class="row">
        <div class="small-actions">
          <label class="chk"><input type="checkbox" id="issueIncludeMeta" checked /> 시간/범위가 있으면 본문에 포함</label>
          <label class="chk"><input type="checkbox" id="issueIncludePayload" /> payload를 본문 하단에 포함</label>
        </div>
        <div class="btns">
          <button class="primary" id="btnIssueGen">생성</button>
          <button class="good" id="btnIssueCopy">복사</button>
          <button class="danger" id="btnIssueReset">리셋</button>
        </div>
      </div>

      <div class="out" aria-live="polite">
        <div class="out-head">
          <div class="out-title">생성 결과</div>
          <div class="pill" id="issueLen">0 chars</div>
        </div>
        <pre id="issueOut"></pre>
      </div>
    </section>

    <!-- PUSH -->
    <section class="card" id="pushCard">
      <h2>PUSH 생성기 <span class="pill">짧고 명확하게</span></h2>

      <div class="grid two">
        <div>
          <label for="pushType">PUSH 타입</label>
          <select id="pushType">
            <option value="notice">공지/안내</option>
            <option value="event">이벤트</option>
            <option value="maintenance">점검 안내</option>
            <option value="hotfix">핫픽스/업데이트</option>
          </select>
        </div>
        <div>
          <label for="pushTone">톤</label>
          <select id="pushTone">
            <option value="neutral">중립</option>
            <option value="friendly">친근</option>
            <option value="urgent">긴급</option>
          </select>
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="pushTitle">PUSH 제목(필수)</label>
          <input id="pushTitle" placeholder="예) 접속 지연 현상 안내" />
        </div>
        <div class="grid two">
          <div>
            <label for="pushBody">PUSH 본문(필수)</label>
            <textarea id="pushBody" placeholder="예) 일부 이용자에게 접속 지연이 발생하고 있어 조치 중입니다. 자세한 내용은 공지를 확인해주세요."></textarea>
          </div>
          <div>
            <label for="pushCta">CTA/링크 문구(선택)</label>
            <input id="pushCta" placeholder="예) 공지 확인하기" />
            <div class="hint">플랫폼에 따라 버튼/딥링크 문구로 사용 가능합니다.</div>

            <div style="height:10px"></div>

            <label for="pushDeepLink">딥링크/URL(선택)</label>
            <input id="pushDeepLink" placeholder="예) app://notice/123 또는 https://..." />
          </div>
        </div>

        <div>
          <label for="pushPayload">추가 데이터 payload (선택, 객체여도 안전)</label>
          <textarea id="pushPayload" placeholder='예) {"screen":"notice","id":123} 또는 텍스트'></textarea>
          <div class="hint">출력 시 JSON 문자열로 안전 변환됩니다.</div>
        </div>
      </div>

      <div class="row">
        <div class="small-actions">
          <label class="chk"><input type="checkbox" id="pushIncludePayload" /> payload 포함</label>
          <label class="chk"><input type="checkbox" id="pushCompact" checked /> 줄바꿈 최소화(컴팩트)</label>
        </div>
        <div class="btns">
          <button class="primary" id="btnPushGen">생성</button>
          <button class="good" id="btnPushCopy">복사</button>
          <button class="danger" id="btnPushReset">리셋</button>
        </div>
      </div>

      <div class="out" aria-live="polite">
        <div class="out-head">
          <div class="out-title">생성 결과</div>
          <div class="pill" id="pushLen">0 chars</div>
        </div>
        <pre id="pushOut"></pre>
      </div>
    </section>
  </main>

  <footer>
    <div>· <b>[object Object]</b> 방지: 모든 출력 값은 내부에서 <code class="k">safeToText()</code>로 문자열화됩니다.</div>
    <div>· Issue 공지 구조: <b>현상 → 사과 → 조치 → 추가 안내</b> 고정 (임시 점검은 “현상 때문에 점검 진행 예정” 인과 유지)</div>
  </footer>

  <div class="toast" id="toast"></div>

  <script>
    // =========================
    // [object Object] 완전 제거를 위한 안전 문자열화
    // =========================
    function safeToText(value) {
      // null/undefined
      if (value === null) return "null";
      if (value === undefined) return "";

      // already string
      if (typeof value === "string") return value;

      // primitive
      if (typeof value === "number" || typeof value === "boolean" || typeof value === "bigint") {
        return String(value);
      }

      // Date
      if (value instanceof Date) {
        const t = value.toISOString?.() || String(value);
        return t;
      }

      // Error
      if (value instanceof Error) {
        return value.stack || value.message || String(value);
      }

      // object/array/function => stringify safely
      try {
        const seen = new WeakSet();
        const json = JSON.stringify(value, (k, v) => {
          if (typeof v === "bigint") return v.toString();
          if (typeof v === "function") return `[Function${v.name ? ":" + v.name : ""}]`;
          if (typeof v === "object" && v !== null) {
            if (seen.has(v)) return "[Circular]";
            seen.add(v);
          }
          return v;
        }, 2);
        // JSON.stringify can return undefined for certain values
        if (json === undefined) return String(value);
        return json;
      } catch (e) {
        // as a last resort, avoid default object toString ([object Object])
        try {
          const tag = Object.prototype.toString.call(value); // [object X]
          return tag === "[object Object]" ? "[Unserializable Object]" : tag;
        } catch {
          return "[Unserializable]";
        }
      }
    }

    function tryParseJsonMaybe(text) {
      const s = (text ?? "").trim();
      if (!s) return "";
      // If it looks like JSON, try to parse then re-stringify to normalize
      const looksJson = (s.startsWith("{") && s.endsWith("}")) || (s.startsWith("[") && s.endsWith("]"));
      if (!looksJson) return s; // keep as-is
      try {
        const obj = JSON.parse(s);
        return obj;
      } catch {
        // not valid JSON -> keep raw string
        return s;
      }
    }

    // =========================
    // UI helpers
    // =========================
    const $ = (id) => document.getElementById(id);

    function setOut(preEl, lenEl, text) {
      preEl.textContent = text || "";
      lenEl.textContent = `${(text || "").length} chars`;
    }

    async function copyToClipboard(text) {
      const t = text || "";
      try {
        await navigator.clipboard.writeText(t);
        toast("클립보드에 복사했어요.");
      } catch {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = t;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try {
          document.execCommand("copy");
          toast("클립보드에 복사했어요.");
        } catch {
          toast("복사에 실패했어요. 결과를 직접 선택해 복사해주세요.");
        } finally {
          document.body.removeChild(ta);
        }
      }
    }

    let toastTimer = null;
    function toast(msg) {
      const el = $("toast");
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => el.classList.remove("show"), 1800);
    }

    // =========================
    // Issue generator (현상 → 사과 → 조치 → 추가 안내)
    // =========================
    function buildIssueNotice() {
      const title = safeToText($("issueTitle").value).trim();
      const type = $("issueType").value;

      const when = safeToText($("issueWhen").value).trim();
      const scope = safeToText($("issueScope").value).trim();

      const symptomRaw = $("issueSymptom").value;
      const apologyRaw = $("issueApology").value;
      const actionRaw = $("issueAction").value;
      const extraRaw  = $("issueExtra").value;

      const symptom = safeToText(symptomRaw).trim();
      const apology = safeToText(apologyRaw).trim();
      const action  = safeToText(actionRaw).trim();
      const extra   = safeToText(extraRaw).trim();

      const includeMeta = $("issueIncludeMeta").checked;
      const includePayload = $("issueIncludePayload").checked;

      const payloadInput = $("issuePayload").value;
      const payloadMaybe = tryParseJsonMaybe(payloadInput);
      const payloadText = safeToText(payloadMaybe).trim();

      // minimal validation (no alerts; just generate best-effort)
      const metaBits = [];
      if (includeMeta && when) metaBits.push(`- 발생/인지 시각: ${when}`);
      if (includeMeta && scope) metaBits.push(`- 영향 범위: ${scope}`);

      // 사과 문장 자동 생성 (유형에 따라 약간 조정)
      let autoApology = "이용에 불편을 드려 대단히 죄송합니다.";
      if (type === "maintenance") autoApology = "이용에 불편을 드려 죄송합니다.";

      // 임시 점검은 ‘현상 때문에 점검 진행 예정’ 인과 유지
      // => action 파트에 강제로 인과 문장을 보강 (기존 action이 있어도 앞에 붙여 자연스럽게)
      let actionLine = action;
      if (type === "maintenance") {
        const cause = symptom ? symptom : "해당 현상";
        const causal = `${cause.replace(/\s+/g, " ").trim()}로 인해 임시 점검을 진행할 예정입니다.`;
        if (actionLine) {
          // 중복 방지: 이미 "점검" 문구가 있으면 그래도 인과 문장만 앞에 붙임(중복 최소)
          actionLine = `${causal}\n${actionLine}`;
        } else {
          actionLine = causal;
        }
      }

      // Compose with fixed structure
      const lines = [];

      if (title) lines.push(title, "");
      lines.push("■ 현상");
      lines.push(symptom || "(현상을 입력해주세요)");
      if (metaBits.length) lines.push("", ...metaBits);

      lines.push("", "■ 사과");
      lines.push(apology || autoApology);

      lines.push("", "■ 조치");
      lines.push(actionLine || "(조치 내용을 입력해주세요)");

      lines.push("", "■ 추가 안내");
      lines.push(extra || "(추가 안내를 입력해주세요)");

      if (includePayload && payloadText) {
        lines.push("", "■ 참고 (payload)");
        lines.push(payloadText);
      }

      return lines.join("\n");
    }

    // =========================
    // PUSH generator
    // =========================
    function tonePrefix(tone, type) {
      if (tone === "urgent") {
        if (type === "maintenance") return "[긴급] ";
        return "[긴급] ";
      }
      if (tone === "friendly") return "";
      return "";
    }

    function buildPush() {
      const type = $("pushType").value;
      const tone = $("pushTone").value;

      const title = safeToText($("pushTitle").value).trim();
      const body  = safeToText($("pushBody").value).trim();
      const cta   = safeToText($("pushCta").value).trim();
      const link  = safeToText($("pushDeepLink").value).trim();

      const includePayload = $("pushIncludePayload").checked;
      const compact = $("pushCompact").checked;

      const payloadInput = $("pushPayload").value;
      const payloadMaybe = tryParseJsonMaybe(payloadInput);
      const payloadText = safeToText(payloadMaybe).trim();

      // light auto-guard for maintenance wording
      let refinedBody = body;
      if (type === "maintenance" && body) {
        // 인과 유지에 도움이 되도록 “~로 인해”가 없으면 완곡하게 보강(강제 수정 X)
        const hasCausal = /로\s*인해|때문에/.test(body);
        if (!hasCausal) refinedBody = `${body} (해당 현상으로 인해 점검이 진행될 수 있습니다.)`;
      }

      const t = `${tonePrefix(tone, type)}${title || "(제목을 입력해주세요)"}`.trim();
      const parts = [];

      if (compact) {
        // compact: 2~4줄
        parts.push(t);
        parts.push(refinedBody || "(본문을 입력해주세요)");
        if (cta && link) parts.push(`${cta} · ${link}`);
        else if (cta) parts.push(cta);
        else if (link) parts.push(link);
        if (includePayload && payloadText) parts.push(`payload: ${payloadText}`);
        return parts.join("\n");
      }

      // expanded
      parts.push(`제목: ${t}`);
      parts.push(`본문: ${refinedBody || "(본문을 입력해주세요)"}`);
      if (cta) parts.push(`CTA: ${cta}`);
      if (link) parts.push(`링크: ${link}`);
      if (includePayload && payloadText) parts.push(`payload:\n${payloadText}`);
      return parts.join("\n");
    }

    // =========================
    // Wire up
    // =========================
    function genIssueAndRender() {
      const text = buildIssueNotice();
      setOut($("issueOut"), $("issueLen"), text);
      return text;
    }

    function genPushAndRender() {
      const text = buildPush();
      setOut($("pushOut"), $("pushLen"), text);
      return text;
    }

    $("btnIssueGen").addEventListener("click", genIssueAndRender);
    $("btnPushGen").addEventListener("click", genPushAndRender);

    $("btnIssueCopy").addEventListener("click", async () => {
      const text = $("issueOut").textContent || genIssueAndRender();
      await copyToClipboard(text);
    });
    $("btnPushCopy").addEventListener("click", async () => {
      const text = $("pushOut").textContent || genPushAndRender();
      await copyToClipboard(text);
    });

    $("btnIssueReset").addEventListener("click", () => {
      ["issueTitle","issueWhen","issueScope","issueSymptom","issueApology","issueAction","issueExtra","issuePayload"].forEach(id => $(id).value = "");
      $("issueIncludeMeta").checked = true;
      $("issueIncludePayload").checked = false;
      $("issueType").value = "incident";
      setOut($("issueOut"), $("issueLen"), "");
      toast("Issue 입력값을 초기화했어요.");
    });

    $("btnPushReset").addEventListener("click", () => {
      ["pushTitle","pushBody","pushCta","pushDeepLink","pushPayload"].forEach(id => $(id).value = "");
      $("pushIncludePayload").checked = false;
      $("pushCompact").checked = true;
      $("pushType").value = "notice";
      $("pushTone").value = "neutral";
      setOut($("pushOut"), $("pushLen"), "");
      toast("PUSH 입력값을 초기화했어요.");
    });

    // live preview (optional but helpful) – keep light
    const issueInputs = ["issueTitle","issueType","issueWhen","issueScope","issueSymptom","issueApology","issueAction","issueExtra","issuePayload","issueIncludeMeta","issueIncludePayload"];
    issueInputs.forEach(id => $(id).addEventListener("input", () => { if ($("issueOut").textContent) genIssueAndRender(); }));
    issueInputs.forEach(id => $(id).addEventListener("change", () => { if ($("issueOut").textContent) genIssueAndRender(); }));

    const pushInputs = ["pushType","pushTone","pushTitle","pushBody","pushCta","pushDeepLink","pushPayload","pushIncludePayload","pushCompact"];
    pushInputs.forEach(id => $(id).addEventListener("input", () => { if ($("pushOut").textContent) genPushAndRender(); }));
    pushInputs.forEach(id => $(id).addEventListener("change", () => { if ($("pushOut").textContent) genPushAndRender(); }));

    // initial sample (empty outputs)
    setOut($("issueOut"), $("issueLen"), "");
    setOut($("pushOut"), $("pushLen"), "");
  </script>
</body>
</html>
